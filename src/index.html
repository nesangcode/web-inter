<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Dicoding Stories - Berbagi cerita seputar perjalanan belajar di Dicoding">
    <meta name="theme-color" content="#6366f1">
    <meta name="view-transition" content="same-origin">
    
    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="https://story-api.dicoding.dev">
    
    <!-- Preload critical resources -->
    
    <link rel="shortcut icon" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Leaflet CSS will be loaded dynamically when user is logged in -->

    <title>Dicoding Stories</title>
  </head>
  <body>
    <!-- Skip to Content Link for Accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <header role="banner">
      <div class="main-header container">
        <a class="brand-name" href="#/" aria-label="Dicoding Stories - Kembali ke beranda">
          <span class="brand-icon" aria-hidden="true">ðŸ“š</span>
          Dicoding Stories
        </a>

        <nav id="navigation-drawer" class="navigation-drawer" role="navigation" aria-label="Main navigation">
          <ul id="nav-list" class="nav-list">
            <li><a href="#/">Beranda</a></li>
            <!-- Authentication links will be inserted here -->
          </ul>
        </nav>

        <button id="drawer-button" class="drawer-button" aria-label="Open navigation menu" aria-expanded="false">â˜°</button>
      </div>
    </header>

    <main id="main-content" class="main-content" role="main" tabindex="-1">
      <!-- Initial loading state -->
      <div id="app-loading" class="app-loading">
        <div class="loading-spinner"></div>
        <p>Memuat aplikasi...</p>
      </div>
    </main>
    
    <footer role="contentinfo" class="main-footer">
      <div class="container">
        <div class="footer-content">
          <h3>Dicoding Stories</h3>
          <p>&copy; 2025 Dicoding Stories. Platform berbagi cerita perjalanan belajar.</p>
        </div>
      </div>
    </footer>
    
    <!-- Load Leaflet JS and CSS only when user is logged in -->
    <script>
      // Lazy load Leaflet only when user is logged in
      window.loadLeaflet = function() {
        return new Promise((resolve, reject) => {
          if (window.L) {
            resolve(window.L);
            return;
          }
          
          // Load CSS first
          const cssLink = document.createElement('link');
          cssLink.rel = 'stylesheet';
          cssLink.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
          cssLink.integrity = 'sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=';
          cssLink.crossOrigin = '';
          document.head.appendChild(cssLink);
          
          // Then load JS
          const script = document.createElement('script');
          script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
          script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=';
          script.crossOrigin = '';
          script.onload = () => resolve(window.L);
          script.onerror = reject;
          document.head.appendChild(script);
        });
      };
    </script>
    
    <!-- Service Worker Registration Script -->
    <script>
      // Register service worker after a delay to not block initial load
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Delay SW registration to prioritize app loading
          setTimeout(() => {
            navigator.serviceWorker.register('./service-worker.js')
              .then(registration => {
                console.log('Service Worker registered successfully:', registration.scope);
                
                // Handle updates
                registration.addEventListener('updatefound', () => {
                  const newWorker = registration.installing;
                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      console.log('New Workbox service worker available');
                    }
                  });
                });
              })
              .catch(registrationError => {
                console.warn('Service Worker registration failed:', registrationError);
              });
          }, 1000);
        });
      }
    </script>
  </body>
</html>
